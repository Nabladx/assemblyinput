LOCALS
 
.model  medium
 
.stack  200h
 
.data
        asPromptMatrix  db      'Enter a matrix:', 0Dh, 0Ah, '$'
        asPromptElement db      0Dh, 0Ah, 'M['
        asI             db      '**, '
        asJ             db      '**] =', '$'
        CrLf            db      0Dh, 0Ah, '$'
        asError         db      0Dh, 0Ah, 'Error', '$'
        msgPressAnyKey  db      0Dh, 0Ah, 'Press any key to exit...', '$'
.data?
        _COLS_          equ     3
        _ROWS_          equ     3
        byMatrix        db      (_COLS_*_ROWS_) dup(?)
 
        byBuffer        db      82 dup(?)
.code
 
; ?????????????? ?????? ? ????? ???????? 1 ????
; ?? ?????:
;   ds:[si] - ?????? ? ?????? ? ??????? Pascal
;             (?????? ???? - ????? ??????, ????? - ???? ??????)
; ?? ??????
;   al - ?????
;   CY - ???? ???????? (??? ?????? - ??????????, ????? - ???????)
Str2Num PROC
        push    bx
        push    cx
        push    dx
        push    si
 
        mov     bl,     10
        xor     ax,     ax
 
        xor     cx,     cx
        mov     cl,     [si]
        inc     si
        jcxz    @@Error
        ;???? ? ?????? ?????? ?????? '-'
        ; - ??????? ? ??????????
        ; - ????????? ?????????? ??????????????? ????????
        cmp     byte ptr [si], '-'
        jne     @@for
        inc     si
        dec     cx
        @@for:
                mul     bl              ; ???????? al ?? 10 ( ax=al*bl )
                cmp     ah,     0       ; ?????????, ????????? ?? ????????????
                jnz     @@Error
 
                mov     dl,     [si]    ; ??????????? ????????? ?????? ? ?????
                inc     si
                sub     dl,     '0'     ; ???? ??? ?? ?????? ????? - ???????? ??????
                jb      @@Error
                cmp     dl,     9
                ja      @@Error
                add     al,     dl
                jc      @@Error         ; ???? ????? ?????? 255
        loop    @@for
 
        pop     si                      ;??? ????????????? ??????? ???? ?????
        push    si
        cmp     byte ptr [si+1], '-'
        jne     @@CheckPositive         ;???? ?????? ???? ?????????????
        neg     al                      ;???? ?????? ???? ?????????????
        jns     @@Error                 ;???? ????????? ????????????? - ??????
        jmp     @@Ok
@@CheckPositive:
        ;?? ????? ?????????? ????????? ?????? - ?.?.
        ;????????? ????????????? ? ????????????? ????? ?? ???????????
        test    al,     al              ;???? ????????? ????????????? - ??????
        js      @@Error
@@Ok:                ;????????? ?????????
        clc
        pop     si
        pop     dx
        pop     cx
        pop     bx
        ret
@@Error:
        stc
        pop     si
        pop     dx
        pop     cx
        pop     bx
        ret
Str2Num ENDP
 
; ??????? ???????? 16-????????? ????? ?? ???????? AX ?? ?????
; ?? ?????:
;  ax - ????? ??? ???????????
; ?? ??????:
;  ????? ?? ??????
ShowInt16       proc
        push    ax
        push    bx
        push    cx
        push    dx
 
        mov     bx,     10      ;????????? ??????? ????????? (????????)
        xor     cx,     cx      ;?????????? ???????? ? ?????? ?????
        or      ax,     ax      ;??? ?????????????? ?????
        jns     @@div
                neg     ax      ;???????? ???? (??????? ?????????????)
                push    ax      ;? ??????? ?? ????? ?????? "-" (?????)
                mov     ah,     02h
                mov     dl,     '-'
                int     21h
                pop     ax
        @@div:                  ;????? ????? ?? 10
                xor     dx,     dx
                div     bx
                push    dx      ;??????? ????????? ? ?????
                inc     cx      ;?????????? ???? ? ?????
                or      ax,     ax
        jnz     @@div           ;?????????, ???? ? ????? ???? ?????
        mov     ah,     02h
        @@store:
                pop     dx      ;????????? ????? (??????? ?? ??????? ?? 10) ?? ?????
                add     dl,     '0'     ;??????????? ? ??????? ????
                int     21h     ;? ??????? ?? ?? ?????
        loop    @@store
 
        pop     dx
        pop     cx
        pop     bx
        pop     ax
        ret
ShowInt16       endp
 
;?????????????? ????? ? ??????
;?? ?????:
;  ax - ?????
;  ds:si - ????? ??????
Int16ToStr      proc
        push    ax
        push    bx
        push    cx
        push    dx
        push    si
        push    di
 
        mov     di,     ax
        mov     bx,     10
        xor     cx,     cx
        test    ax,     ax
        jns     @@div
                neg     ax
        @@div:
                inc     cx
                xor     dx,     dx
                div     bx
                add     dl,     '0'
                push    dx
                test    ax,     ax
        jnz     @@div
 
        test    di,     di
        jns     @@save
                mov     ax,     '-'
                push    ax
                inc     cx
        @@save:
                pop     ax
                mov     [si],   al
                inc     si
        loop    @@save
 
        pop     di
        pop     si
        pop     dx
        pop     cx
        pop     bx
        pop     ax
        ret
Int16ToStr      endp
 
;???? ??????? ?? ??????
;?? ?????:
;  ds:si - ????? ???????
InputMatrix     proc
        mov     bx,     1
        @@forI:
                push    bx
                mov     di,     1
                @@forJ:
                        push    di
                        push    si
                        ;???????????? ?????? ??????????? ?? ????? ?????? ????????
                        mov     word ptr [asI], '  '
                        mov     word ptr [asJ], '  '
                        lea     si,     [asI]
                        mov     ax,     bx
                        call    Int16ToStr
                        lea     si,     [asJ]
                        mov     ax,     di
                        call    Int16ToStr
                @@ShowPrompt:
                        ;??????? ?????? ???????????
                        mov     ah,     09h
                        lea     dx,     [asPromptElement]
                        int     21h
                        ;???? ??????
                        mov     [byBuffer],     5
                        mov     ah,     0Ah
                        lea     dx,     [byBuffer]
                        int     21h
                        ;?????????????? ?????? ? ?????
                        lea     si,     [byBuffer+1]
                        call    Str2Num
                        ;???? ?????? - ???????? ?????? ? ????????? ????
                        jnc     @@store
                        mov     ah,     09h
                        lea     dx,     [asError]
                        int     21h
                        jmp     @@ShowPrompt
                @@store:
                        ;????????? ????? ? ??????? ? ?????????? ????????
                        pop     si
                        mov     [si],   al
                        add     si,     1
                        pop     di
                        inc     di
                        cmp     di,     _COLS_
                jbe     @@forJ
                pop     bx
                inc     bx
                cmp     bx,     _ROWS_
        jbe     @@forI
        mov     ah,     09h
        lea     dx,     [CrLf]
        int     21h
 
        ret
InputMatrix     endp
 
;????? ???????
;?? ?????:
;  ds:si - ????? ???????
ShowMatrix      proc
        mov     cx,     _ROWS_
        @@forI:
                push    cx
                mov     cx,     _COLS_
                @@forJ:
                        lodsb
                        cbw
                        call    ShowInt16
                        mov     al,     ' '
                        int     29h
                loop    @@forJ
                mov     ah,     09h
                lea     dx,     [CrLf]
                int     21h
                pop     cx
        loop    @@forI
        ret
ShowMatrix      endp
 
main    proc
        ;????????????? ??????????? ???????? ds ??????? ???????? ??????
        mov     ax,     @data
        mov     ds,     ax
 
        mov     ah,     09h
        lea     dx,     [asPromptMatrix]
        int     21h
        lea     si,     [byMatrix]
        call    InputMatrix
 
        lea     si,     [byMatrix]
        call    ShowMatrix
 
        ;???????? ??????? ????? ???????
        mov     ah,     09h
        lea     dx,     [msgPressAnyKey]
        int     21h
 
        mov     ah,     00h
        int     16h
 
        ;?????????? ?????????
        mov     ax,     4C00h
        int     21h
main    endp
 
end     main